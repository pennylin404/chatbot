<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Origin åŒæ­¥é©—è­‰ - ç°¡åŒ–ç‰ˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid transparent;
        }
        .log-success { border-left-color: #4ec9b0; color: #4ec9b0; }
        .log-info { border-left-color: #569cd6; color: #569cd6; }
        .log-warning { border-left-color: #dcdcaa; color: #dcdcaa; }
        .log-error { border-left-color: #f48771; color: #f48771; }
        .config-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        code {
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Origin è‡ªå‹•åŒæ­¥é©—è­‰</h1>
    
    <div class="config-box">
        <h3>ğŸ“‹ ç•¶å‰é…ç½®</h3>
        <p><strong>Origin:</strong> <code id="current-origin">è¼‰å…¥ä¸­...</code></p>
        <p><strong>Token:</strong> <code>EzLkESGW0zOk0bwj</code></p>
        <p><strong>BaseURL:</strong> <code>http://localhost:3000</code></p>
    </div>

    <div class="config-box">
        <h3>ğŸ“Š åŸ·è¡Œæ—¥èªŒ</h3>
        <div class="log-container" id="logContainer"></div>
    </div>

    <script>
        // æ—¥èªŒå‡½æ•¸
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, message);
        }

        // é…ç½® Chatbot
        window.difyChatbotConfig = {
            token: 'EzLkESGW0zOk0bwj',
            baseUrl: 'http://localhost:3000',
            inputs: {
                origin: 'https://domain-a.example.com'
            }
        };

        log('âœ… window.difyChatbotConfig å·²è¨­å®š', 'success');
        log(`   Origin: ${window.difyChatbotConfig.inputs.origin}`, 'info');
        document.getElementById('current-origin').textContent = window.difyChatbotConfig.inputs.origin;

        // ç›£è½æ‰€æœ‰ message äº‹ä»¶
        window.addEventListener('message', (event) => {
            log(`ğŸ“¥ æ”¶åˆ° message äº‹ä»¶`, 'info');
            log(`   Type: ${event.data.type}`, 'info');
            log(`   Origin: ${event.origin}`, 'info');

            if (event.data.type === 'dify-chatbot-iframe-ready') {
                log('ğŸ‰ Chatbot iframe å·²å°±ç·’ï¼', 'success');
                log('   é€™è¡¨ç¤º embed.js æˆåŠŸè¼‰å…¥ä¸¦åŸ·è¡Œ', 'success');
            }

            if (event.data.type === 'dify-chatbot-update-inputs') {
                log('ğŸ”„ æ”¶åˆ° update-inputs è¨Šæ¯', 'success');
                log(`   æ–°çš„ origin: ${event.data.payload?.inputs?.origin}`, 'success');
                log('   âœ… è‡ªå‹•åŒæ­¥æˆåŠŸï¼', 'success');
            }

            if (event.data.type === 'dify-chatbot-config') {
                log('âš™ï¸ æ”¶åˆ° config è¨Šæ¯', 'info');
            }
        });

        // æª¢æŸ¥ embed.js æ˜¯å¦è¼‰å…¥
        window.addEventListener('load', () => {
            log('ğŸ“„ é é¢è¼‰å…¥å®Œæˆ', 'info');
            
            setTimeout(() => {
                const embedScript = document.querySelector('script[src*="embed.min.js"]');
                if (embedScript) {
                    log('âœ… embed.min.js script æ¨™ç±¤å·²æ‰¾åˆ°', 'success');
                } else {
                    log('âŒ æ‰¾ä¸åˆ° embed.min.js script æ¨™ç±¤', 'error');
                }

                const chatbotButton = document.getElementById('dify-chatbot-bubble-button');
                if (chatbotButton) {
                    log('âœ… Chatbot æŒ‰éˆ•å·²å»ºç«‹', 'success');
                } else {
                    log('âš ï¸ Chatbot æŒ‰éˆ•å°šæœªå»ºç«‹ï¼ˆå¯èƒ½é‚„åœ¨è¼‰å…¥ä¸­ï¼‰', 'warning');
                }

                const chatbotIframe = document.getElementById('dify-chatbot-bubble-window');
                if (chatbotIframe) {
                    log('âœ… Chatbot iframe å·²å»ºç«‹', 'success');
                } else {
                    log('âš ï¸ Chatbot iframe å°šæœªå»ºç«‹', 'warning');
                }
            }, 2000);
        });

        // æª¢æ¸¬ script è¼‰å…¥éŒ¯èª¤
        window.addEventListener('error', (event) => {
            if (event.target.tagName === 'SCRIPT') {
                log(`âŒ Script è¼‰å…¥å¤±æ•—: ${event.target.src}`, 'error');
            }
        }, true);

        log('ğŸš€ é©—è­‰é é¢åˆå§‹åŒ–å®Œæˆ', 'info');
        log('   ç­‰å¾… embed.min.js è¼‰å…¥...', 'info');
    </script>

    <!-- è¼‰å…¥ embed.min.js -->
    <script src="http://localhost:3000/embed.min.js" defer></script>
</body>
</html>
